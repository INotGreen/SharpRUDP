# 前言

我曾经尝试将RUDP打造成不标准的TCP/UDP通信协议，并且同时拥有TCP的稳定性和UDP的隐蔽性， 它的流量可能不会受到传统的安全设备的监控，这可能是红队和安全开发人员想要的玩意，不过这只是一个例子，如果你想将它添加到生产应用中去，可能还要实现加密算法，和序列化传输等操作。

# 通信机制

#### 1.三次握手:

SYN (客户端 -> 服务端): 客户端发送一个带有SYN标志的数据包，请求建立连接。

SYN-ACK (服务端 -> 客户端): 服务端确认收到SYN，并发送带有SYN和ACK标志的数据包作为响应。

ACK (客户端 -> 服务端): 客户端发送一个带有ACK标志的数据包，确认连接已建立。

#### 2.数据传输:

客户端和服务端可以开始发送数据。每次数据传输后，接收方都会发送一个ACK来确认数据已收到。与TCP类似，RUDP可能会为接收到的数据包发送确认信号。这确保了数据包成功到达目的地。

#### 3.心跳机制:

为了确保连接的活动状态，在建立连接后，客户端和服务端都会周期性地发送心跳数据包。如果某一方在指定的时间内没有收到心跳，它会认为连接已断开，并尝试重新建立连接。

4. #### 数据包重传:

设置一个布尔值IsConnected，如果发送方在预定时间内未收到确认信号，它可能会重传数据包。大概功能为：客户端通过向服务端发

送ACK-SYN包进行数据包的握手，先确认是否连接成功，如果连接成功则IsConnected返回为True，反之则返回False，并且进行重连，以此往复循环。

#### 5.有序性和安全性:

加密技术:可以使用AES、RSA或其他加密算法对RUDP数据进行加密。加密密钥可以通过Diffie-Hellman密钥交换协议或其他安全的方法进行交换。

身份验证机制:使用数字证书和公钥基础设施 (PKI) 为RUDP连接提供身份验证。这确保了数据的真实性和完整性，并防止了中间人攻击。

#### 6.拥塞控制:

RUDP需要调整其数据包发送速率，以避免网络拥塞。

#### 7.流量控制:

RUDP使用滑动窗口或其他机制来控制数据的流量，确保接收方不会被淹没。

#### 8.结束连接:

当客户端或服务端想要关闭连接时，它会发送一个带有FIN标志的数据包。对方收到此数据包后，会发送一个ACK来确认，并关闭连接。

![](image\image-20230928233542193.png)